ğŸ¯ GOAL

I am building a production-grade GitHub-style Markdown Navigator for DSA learning, with strict API protection and quota control to prevent GitHub API exhaustion.

This is NOT a GitHub clone â€” it is inspired by GitHubâ€™s navigation and interaction patterns, but optimized for structured learning, not browsing.

This system must remain:
deterministic
quota-safe
session-locked
SPA-stable
production-grade


ğŸ“ AUTHORITATIVE FILE TREE (CURRENT STATE)

.next/

app/
â”œâ”€ admin/
â”‚ â”œâ”€ dashboard/
â”‚ â”‚ â””â”€ page.tsx            # Admin dashboard UI
â”‚ â”œâ”€ login/
â”‚ â”‚ â””â”€ page.tsx            # Admin login UI
â”‚ â””â”€ page.tsx              # Admin entry
â”‚
â”œâ”€ api/
â”‚ â”œâ”€ admin/
â”‚ â”‚ â”œâ”€ login/
â”‚ â”‚ â”œâ”€ logout/
â”‚ â”‚ â”œâ”€ revalidate/
â”‚ â”‚ â”œâ”€ session/
â”‚ â”‚ â””â”€ tokens/
â”‚ â”‚
â”‚ â”œâ”€ journal/
â”‚ â”‚ â””â”€ route.ts            # Protected markdown fetch (journal repo)
â”‚ â”‚
â”‚ â””â”€ markdown/
â”‚     â””â”€ route.ts          # Protected markdown fetch (generic repos)
â”‚
â”œâ”€ journal/                # Journal-specific shell entry
â”‚
â”œâ”€ favicon.ico
â”œâ”€ globals.css             # ONLY global CSS file
â”œâ”€ layout.tsx              # Global layout + theme bootstrap
â”œâ”€ not-found.tsx
â””â”€ page.tsx                # Entry â†’ mounts RepoShell


components/
â”œâ”€ admin/
â”‚ â”œâ”€ CreateTokenModal.tsx
â”‚ â”œâ”€ EditTokenModal.tsx
â”‚ â””â”€ TokenRow.tsx
â”‚
â”œâ”€ info/
â”‚ â”œâ”€ AboutThisApp.tsx
â”‚ â”œâ”€ FairUsageInfo.tsx
â”‚ â””â”€ KeyboardShortcutsInfo.tsx
â”‚
â”œâ”€ DrawOverlay.tsx
â”œâ”€ GlobalBlockedScreen.tsx
â”œâ”€ InfoModal.tsx
â”œâ”€ MarkdownSkeleton.tsx
â”œâ”€ MarkdownViewer.tsx
â”œâ”€ RepoContent.tsx
â”œâ”€ RepoShell.tsx
â”œâ”€ RevisionMode.tsx
â”œâ”€ Sidebar.tsx
â”œâ”€ SidebarSearch.tsx
â”œâ”€ TableOfContents.tsx
â”œâ”€ TokenEntryModal.tsx
â””â”€ TopNavbar.tsx


lib/
â”œâ”€ github.ts               # GitHub API tree + file fetch
â”œâ”€ indexer.ts              # buildIndex() â€” folder + file normalization
â”œâ”€ redis.ts                # Upstash Redis client
â””â”€ token.ts                # ğŸ” Token system (quota + session lock)


public/
.env.local
middleware.ts              # Protects /admin + /api/admin routes
next.config.ts
eslint.config.mjs


ğŸ§± CORE APP FEATURES (LOCKED â€” DO NOT BREAK)

ğŸ“‚ Navigation & UI

Sidebar-based file navigation  
Folder expand / collapse  
Active file highlighting  
Auto-scroll to active file  
Sidebar + TOC toggle  
Global search (Fuse.js)  
Keyboard-first UX  
Mobile-safe behavior  
SPA-style navigation using React state + URL hash  
ZERO route remounts  
Single scroll container (NO window scroll)  
Split-view shares activePath  
Invalid hashes soft-reset (no reload)  
Repo change resets state, refresh does NOT  


ğŸ“„ Markdown

GitHub-Flavored Markdown (GFM)  
Copy buttons  
Font zoom  
Stable TOC with active section tracking  
Single backend fetch per file (shared across split panes)  


ğŸ“˜ Revision Mode

Flashcard-style learning  
Front (Problem / Examples)  
Back (Approach Code)  
Keyboard navigation between approaches  
Same access rules as Read mode  
Disables split + TOC automatically  


ğŸ”€ Split View (Desktop Only)

Vertical & horizontal split  
Same SPA shell (shared activePath)  
No duplicate GitHub fetches  
Independent scroll containers  
Resizable divider  
Disabled on mobile  


âœï¸ Draw Mode

Client-only overlay  
No markdown mutation  
Keyboard toggle (D)  
Works in read + split mode  


ğŸ§­ ONBOARDING & INFO SYSTEM

Guided Tour  
Shown only on first visit  
Can be manually started from Info â†’ Start Guided Tour  

Explains:
Sidebar navigation  
Revision mode  
Split view (desktop-only)  
Draw mode  
Search & TOC  

Never forces UI state  
Skips desktop-only steps on mobile  

Info Modal  
Tabs:
About this App  
Keyboard Shortcuts  
Fair Usage & Limits  

Mobile:
Single stacked tab  

Desktop:
Sidebar tabs  

Footer attribution only  


ğŸ” ACCESS CONTROL SYSTEM (CORE FOCUS)

Identity Model

Each request is identified by:
x-dev-token â†’ access identity  
x-session-id â†’ browser instance  

Public token via:
NEXT_PUBLIC_PUBLIC_TOKEN  

ALL GitHub API calls are backend-gated  


ğŸ§  TOKEN META (REDIS)

token:<token>:meta {
  name
  quotaScope        // session | token
  resetPolicy       // daily | never
  limit
  enabled
  createdAt
}


ğŸ§  SESSION LOCK (ANTI-SHARING)

token:<token>:active_session = <sessionId>

TTL-based sliding lock  
Same session refreshes TTL  
Different session â†’ BLOCKED (TOKEN_IN_USE)  


ğŸ“Š QUOTA SYSTEM (CRITICAL)

quota:<scope>:<date | lifetime>

Where scope is:
session:<sessionId>  
token:<token>  

Rules:
Checked BEFORE GitHub fetch  
Consumed ONLY AFTER successful fetch  
Daily quotas expire via TTL  
Lifetime quotas never expire  


ğŸš« BLOCKED USER UX (MANDATORY)

States:
ok  
blocked  
awaiting_token  

Rules:
Fullscreen blocked screen  
Reason always shown  
Actions:
Retry access  
Enter token  
Contact via LinkedIn  

No skeletons  
No silent failures  

LinkedIn:
https://www.linkedin.com/in/tazeem-khan-662a24207/  


ğŸ§‘â€ğŸ’» ADMIN SYSTEM

Auth:
Password-based  
ADMIN_PASSWORD env  
HTTP-only cookie  
Protected by middleware  

Capabilities:
List tokens (SCAN-based)  
Create token  
Enable / disable token  
Reset quota  
Delete token  
Switch quota scope  
Trigger revalidation  
Client-side admin toast after actions  


ğŸš« HARD RULES

Before suggesting ANY change:
Ask for the relevant file(s)  
Do NOT assume implementations  
Do NOT invent missing code  
Do NOT refactor architecture  
Fix ONE thing at a time  
Respect Redis free-tier limits  
Do NOT break existing UX  
Backend first, UI later
